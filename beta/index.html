<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NFL Team Owners Standings</title>

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 10px;
        }



        .standings-table {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background-color: #2c3e50;
            color: white;
            padding: 15px 10px;
            text-align: center;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        td {
            padding: 15px 10px;
            text-align: center;
            border-bottom: 1px solid #ecf0f1;
        }

        tr:hover {
            background-color: #f8f9fa;
        }



        .rank {
            font-weight: bold;
            color: #2c3e50;
        }

        .owner-name {
            font-weight: 600;
            color: #34495e;
        }

        .record {
            font-weight: 500;
        }

        .team-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .team-info-stacked {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
        }

        .team-logo {
            width: 35px;
            height: 35px;
            object-fit: contain;
        }

        .team-record {
            font-size: 0.85rem;
            color: #666;
        }



        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
            color: #666;
        }

        .error {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
            color: #e74c3c;
        }

        .last-updated {
            text-align: center;
            margin-top: 20px;
            color: #666;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 5px;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .header {
                padding: 15px;
                margin-bottom: 15px;
            }

            /* Optimize table for mobile */
            .standings-table {
                font-size: 0.75rem;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            table {
                min-width: 100%;
                width: auto;
            }

            th, td {
                padding: 8px 3px;
                font-size: 0.7rem;
                white-space: nowrap;
            }

            th {
                font-size: 0.65rem;
                padding: 10px 3px;
            }

            /* Rank column */
            th:nth-child(1), td:nth-child(1) {
                width: 8%;
                min-width: 25px;
            }

            /* Owner column */
            th:nth-child(2), td:nth-child(2) {
                width: 12%;
                min-width: 40px;
                font-size: 0.65rem;
            }

            /* Record column */
            th:nth-child(3), td:nth-child(3) {
                width: 18%;
                min-width: 60px;
                font-size: 0.65rem;
            }

            /* Team logo columns */
            th:nth-child(4), th:nth-child(6), th:nth-child(8),
            td:nth-child(4), td:nth-child(6), td:nth-child(8) {
                width: 10%;
                min-width: 35px;
                padding: 5px 2px;
            }

            /* Team record columns */
            th:nth-child(5), th:nth-child(7), th:nth-child(9),
            td:nth-child(5), td:nth-child(7), td:nth-child(9) {
                width: 14%;
                min-width: 45px;
                font-size: 0.6rem;
            }

            .team-logo {
                width: 20px;
                height: 20px;
            }

            .rank {
                font-size: 0.7rem;
            }

            .owner-name {
                font-size: 0.65rem;
                font-weight: 600;
            }

            .record {
                font-size: 0.65rem;
            }



            .team-record {
                font-size: 0.6rem;
            }




        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>NFL Team Owners Standings</h1>
    </div>

    <div class="standings-table">
        <div id="loading" class="loading">Loading standings...</div>
        <div id="error" class="error" style="display: none;"></div>
        <table id="standings" style="display: none;">
            <thead>
            <tr>
                <th>Rank</th>
                <th>Owner</th>
                <th>Record</th>
                <th colspan="2">T1</th>
                <th colspan="2">T2</th>
                <th colspan="2">T3</th>
            </tr>
            </thead>
            <tbody id="tableBody"></tbody>
        </table>
    </div>

    <div class="last-updated" id="lastUpdated"></div>
</div>

<script>
    // Team to owner mapping
    const teamToOwner = {
        "ARI": "Jon",
        "ATL": "Cole",
        "BAL": "Jake",
        "BUF": "Ryan",
        "CAR": "Rohit",
        "CHI": "Nathan",
        "CIN": "Nathan",
        "CLE": "",
        "DAL": "John",
        "DEN": "Cody",
        "DET": "John",
        "GB": "Mike",
        "HOU": "Mike",
        "IND": "Jake",
        "JAX": "Jon",
        "LAC": "Rohit",
        "LAR": "Ossman",
        "LV": "Jake",
        "KC": "Rohit",
        "MIA": "Mike",
        "MIN": "Nathan",
        "NE": "Cole",
        "NO": "",
        "NYG": "Ossman",
        "NYJ": "Cody",
        "PHI": "Ossman",
        "PIT": "John",
        "SEA": "Ryan",
        "SF": "Cole",
        "TB": "Jon",
        "TEN": "Ryan",
        "WSH": "Cody"
    };

    // Initialize data structures
    const owners = ["Cody", "Cole", "Jake", "John", "Jon", "Mike", "Nathan", "Ossman", "Rohit", "Ryan"];
    const ownerToTeams = {};
    const ownerToRecord = {};
    const teamToStats = {};

    // Initialize owner data
    owners.forEach(owner => {
        ownerToTeams[owner] = [];
        ownerToRecord[owner] = { wins: 0, losses: 0, ties: 0 };
    });

    // ESPN API endpoint
    const espnStandingsUrl = "https://site.api.espn.com/apis/v2/sports/football/nfl/standings?seasontype=2";

    // Main function to generate rankings
    async function generateRanking() {
        try {
            await fetchAndAggregate();
            renderRanking();
            updateLastUpdated();
        } catch (error) {
            console.error('Error generating rankings:', error);
            showError('Failed to load standings. Please refresh the page.');
        }
    }

    // Fetch standings data
    async function fetchAndAggregate() {
        const response = await axios.get(espnStandingsUrl);
        const afcTeams = response.data.children[0].standings.entries;
        const nfcTeams = response.data.children[1].standings.entries;
        const allTeams = [...afcTeams, ...nfcTeams];

        allTeams.forEach(teamData => {
            const teamAbbreviation = teamData.team.abbreviation;
            const ownerName = teamToOwner[teamAbbreviation];

            if (ownerName) {
                teamToStats[teamAbbreviation] = teamData.stats;

                const teamSummary = {
                    abbreviation: teamAbbreviation,
                    id: teamData.team.id,
                    logos: teamData.team.logos,
                    wins: 0,
                    losses: 0,
                    ties: 0
                };

                teamData.stats.forEach(stat => {
                    if (stat.name === "wins") {
                        ownerToRecord[ownerName].wins += stat.value;
                        teamSummary.wins = stat.value;
                    } else if (stat.name === "losses") {
                        ownerToRecord[ownerName].losses += stat.value;
                        teamSummary.losses = stat.value;
                    } else if (stat.name === "ties") {
                        ownerToRecord[ownerName].ties += stat.value;
                        teamSummary.ties = stat.value;
                    }
                });



                ownerToTeams[ownerName].push(teamSummary);
            }
        });
    }



    // Calculate win percentage for an owner
    function calculateWinPercentage(wins, losses, ties) {
        const totalGames = wins + losses + ties;
        if (totalGames === 0) return 0;
        // NFL win percentage counts ties as half a win
        return ((wins + (ties * 0.5)) / totalGames) * 100;
    }

    // Get win percentage classification
    function getWinPctClass(winPct) {
        if (winPct >= 60) return 'win-pct-high';
        if (winPct >= 40) return 'win-pct-medium';
        return 'win-pct-low';
    }

    // Format win percentage display
    function formatWinPct(winPct) {
        return winPct.toFixed(1) + '%';
    }

    // Render the rankings table
    function renderRanking() {
        const ownerList = [];

        for (const [owner, record] of Object.entries(ownerToRecord)) {
            const winPct = calculateWinPercentage(record.wins, record.losses, record.ties);
            ownerList.push({
                owner,
                wins: record.wins,
                losses: record.losses,
                ties: record.ties,
                winPercentage: winPct
            });
        }

        // Sort by wins (descending)
        ownerList.sort((a, b) => b.wins - a.wins);

        // Clear table body
        const tableBody = document.getElementById('tableBody');
        tableBody.innerHTML = '';

        // Assign ranks with golf-style ranking for ties (tied players get LAST position they occupy)
        for (let i = 0; i < ownerList.length; i++) {
            let tiedCount = 1;
            // Count how many people are tied with this person
            for (let j = i + 1; j < ownerList.length; j++) {
                if (ownerList[j].wins === ownerList[i].wins) {
                    tiedCount++;
                } else {
                    break;
                }
            }
            
            // All tied players get the rank of the last position in the group
            const lastPositionRank = i + tiedCount;
            for (let k = i; k < i + tiedCount; k++) {
                ownerList[k].rank = lastPositionRank;
            }
            
            // Skip past the tied players
            i += tiedCount - 1;
        }

        ownerList.forEach((item, index) => {
            const record = `${item.wins} - ${item.losses} - ${item.ties}`;
            const teams = ownerToTeams[item.owner];

            // Sort teams by wins
            teams.sort((a, b) => b.wins - a.wins);

            // Create row
            const row = document.createElement('tr');

            // Rank
            const rankCell = document.createElement('td');
            rankCell.innerHTML = `<span class="rank">${item.rank}</span>`;
            row.appendChild(rankCell);

            // Owner name
            const ownerCell = document.createElement('td');
            ownerCell.innerHTML = `<span class="owner-name">${item.owner}</span>`;
            row.appendChild(ownerCell);

            // Overall record
            const recordCell = document.createElement('td');
            recordCell.innerHTML = `<span class="record">${record}</span>`;
            row.appendChild(recordCell);

            // Team cells
            teams.forEach(team => {
                // Logo cell
                const logoCell = document.createElement('td');
                logoCell.innerHTML = `<div class="team-info"><img class="team-logo" src="${team.logos[0].href}" alt="${team.abbreviation}"></div>`;
                row.appendChild(logoCell);

                // Record cell
                const teamRecordCell = document.createElement('td');
                teamRecordCell.innerHTML = `<span class="team-record">${team.wins} - ${team.losses} - ${team.ties}</span>`;
                row.appendChild(teamRecordCell);
            });

            tableBody.appendChild(row);
        });

        // Show table and hide loading
        document.getElementById('loading').style.display = 'none';
        document.getElementById('standings').style.display = 'table';
    }

    // Update last updated timestamp
    function updateLastUpdated() {
        const now = new Date();
        const timeString = now.toLocaleString('en-US', {
            weekday: 'short',
            year: 'numeric',
            month: 'short',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
        });
        document.getElementById('lastUpdated').textContent = `Last updated: ${timeString}`;
    }

    // Show error message
    function showError(message) {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('error').style.display = 'block';
        document.getElementById('error').textContent = message;
    }

    // Initialize on page load - updated ranking logic
    window.addEventListener('DOMContentLoaded', generateRanking);
</script>
</body>
</html>
